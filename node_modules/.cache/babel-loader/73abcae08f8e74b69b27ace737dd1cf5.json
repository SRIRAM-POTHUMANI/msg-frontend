{"ast":null,"code":"import _defineProperty from\"E:/msg/msg-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"E:/msg/msg-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/msg/msg-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:/msg/msg-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"E:/msg/msg-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React from\"react\";import clsx from\"clsx\";import Pusher from\"pusher-js\";import{makeStyles,useTheme}from\"@material-ui/core/styles\";import Drawer from\"@material-ui/core/Drawer\";import AppBar from\"@material-ui/core/AppBar\";import Toolbar from\"@material-ui/core/Toolbar\";import List from\"@material-ui/core/List\";import CssBaseline from\"@material-ui/core/CssBaseline\";import Typography from\"@material-ui/core/Typography\";import Divider from\"@material-ui/core/Divider\";import IconButton from\"@material-ui/core/IconButton\";import MenuIcon from\"@material-ui/icons/Menu\";import ChevronLeftIcon from\"@material-ui/icons/ChevronLeft\";import ChevronRightIcon from\"@material-ui/icons/ChevronRight\";import ListItem from\"@material-ui/core/ListItem\";import ListItemIcon from\"@material-ui/core/ListItemIcon\";import ListItemText from\"@material-ui/core/ListItemText\";import InboxIcon from\"@material-ui/icons/MoveToInbox\";import MailIcon from\"@material-ui/icons/Mail\";import{Avatar}from\"@material-ui/core\";import PersonIcon from\"@material-ui/icons/Person\";import Chatbody from\"./Chatbody\";import\"./Chat.css\";// import Pusher from \"pusher-js\";\nimport{useEffect,useState,useRef}from\"react\";import axios from\"./axios\";import jwt_decode from\"jwt-decode\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var token=localStorage.getItem(\"token\");var decoded=jwt_decode(token);var existingUser=decoded.existUser.name;var drawerWidth=200;var useStyles=makeStyles(function(theme){return{root:{display:\"flex\"},appBar:{transition:theme.transitions.create([\"margin\",\"width\"],{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen})},appBarShift:{width:\"calc(100% - \".concat(drawerWidth,\"px)\"),marginLeft:drawerWidth,transition:theme.transitions.create([\"margin\",\"width\"],{easing:theme.transitions.easing.easeOut,duration:theme.transitions.duration.enteringScreen})},menuButton:{marginRight:theme.spacing(2)},hide:{display:\"none\"},drawer:{width:drawerWidth,flexShrink:0},drawerPaper:{width:drawerWidth},drawerHeader:_objectSpread(_objectSpread({display:\"flex\",alignItems:\"center\",padding:theme.spacing(0,1)},theme.mixins.toolbar),{},{justifyContent:\"flex-end\"}),content:{flexGrow:1,padding:theme.spacing(3),transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen}),marginLeft:-drawerWidth},contentShift:{transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.easeOut,duration:theme.transitions.duration.enteringScreen}),marginLeft:0}};});export default function Chat(){//messages\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),recievername=_useState4[0],setrecievername=_useState4[1];useEffect(function(){setUsername(existingUser);setrecievername(prompt(\"Please enter to name\"));},[]);var pusher=new Pusher(\"7b837337ccb8aebc6007\",{cluster:\"ap2\"});var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),messages=_useState6[0],setMessages=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),userList=_useState8[0],setuserList=_useState8[1];var messagesEndRef=useRef(null);var scrollToBottom=function scrollToBottom(){var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};var sync=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/messages/sync\").then(function(res){setMessages(res.data);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function sync(){return _ref.apply(this,arguments);};}();var userlist=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(\"/users/userlist\").then(function(res){setuserList(res.data);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function userlist(){return _ref2.apply(this,arguments);};}();// useEffect(() => {\n//   userlist();\n//   sync();\n//   scrollToBottom();\n// });\n// ()=>{\n// sync();\n// userlist();\n// }\n// pusher\nuseEffect(function(){var channel=pusher.subscribe(\"mern-msg\");channel.bind(\"inserted\",function(newMessage){sync();userlist();});return function(){channel.unbind_all();};},[messages]);//drawers\nvar classes=useStyles();var theme=useTheme();var _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),open=_React$useState2[0],setOpen=_React$useState2[1];var handleDrawerOpen=function handleDrawerOpen(){setOpen(true);};var handleDrawerClose=function handleDrawerClose(){setOpen(false);};console.log(userlist);return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(CssBaseline,{}),/*#__PURE__*/_jsx(AppBar,{position:\"fixed\",className:clsx(classes.appBar,_defineProperty({},classes.appBarShift,open)),children:/*#__PURE__*/_jsxs(Toolbar,{children:[/*#__PURE__*/_jsx(IconButton,{color:\"inherit\",\"aria-label\":\"open drawer\",onClick:handleDrawerOpen,edge:\"start\",className:clsx(classes.menuButton,open&&classes.hide),children:/*#__PURE__*/_jsx(MenuIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",noWrap:true,children:\"Persistent drawer\"})]})}),/*#__PURE__*/_jsxs(Drawer,{className:classes.drawer,variant:\"persistent\",anchor:\"left\",open:open,classes:{paper:classes.drawerPaper},children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.drawerHeader,children:[/*#__PURE__*/_jsx(Avatar,{}),/*#__PURE__*/_jsx(\"h2\",{children:\"Sender name\"}),/*#__PURE__*/_jsx(IconButton,{onClick:handleDrawerClose,children:theme.direction===\"ltr\"?/*#__PURE__*/_jsx(ChevronLeftIcon,{}):/*#__PURE__*/_jsx(ChevronRightIcon,{})})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(List,{children:userList.map(function(users){return/*#__PURE__*/_jsxs(ListItem,{button:true,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(Avatar,{className:classes.small})}),/*#__PURE__*/_jsx(ListItemText,{primary:users.name})]},users._id);})})]}),/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat fixed-bottom\",children:[/*#__PURE__*/_jsx(Chatbody,{messages:messages,name:username,toName:recievername}),scrollToBottom()]})})]});}","map":{"version":3,"sources":["E:/msg/msg-frontend/src/Chat.js"],"names":["React","clsx","Pusher","makeStyles","useTheme","Drawer","AppBar","Toolbar","List","CssBaseline","Typography","Divider","IconButton","MenuIcon","ChevronLeftIcon","ChevronRightIcon","ListItem","ListItemIcon","ListItemText","InboxIcon","MailIcon","Avatar","PersonIcon","Chatbody","useEffect","useState","useRef","axios","jwt_decode","token","localStorage","getItem","decoded","existingUser","existUser","name","drawerWidth","useStyles","theme","root","display","appBar","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","width","marginLeft","easeOut","enteringScreen","menuButton","marginRight","spacing","hide","drawer","flexShrink","drawerPaper","drawerHeader","alignItems","padding","mixins","toolbar","justifyContent","content","flexGrow","contentShift","Chat","username","setUsername","recievername","setrecievername","prompt","pusher","cluster","messages","setMessages","userList","setuserList","messagesEndRef","scrollToBottom","current","scrollIntoView","behavior","sync","get","then","res","data","userlist","channel","subscribe","bind","newMessage","unbind_all","classes","open","setOpen","handleDrawerOpen","handleDrawerClose","console","log","paper","direction","map","users","small","_id"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport clsx from \"clsx\";\r\nimport Pusher from \"pusher-js\";\r\nimport { makeStyles, useTheme } from \"@material-ui/core/styles\";\r\nimport Drawer from \"@material-ui/core/Drawer\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport List from \"@material-ui/core/List\";\r\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Divider from \"@material-ui/core/Divider\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport MenuIcon from \"@material-ui/icons/Menu\";\r\nimport ChevronLeftIcon from \"@material-ui/icons/ChevronLeft\";\r\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport InboxIcon from \"@material-ui/icons/MoveToInbox\";\r\nimport MailIcon from \"@material-ui/icons/Mail\";\r\nimport { Avatar } from \"@material-ui/core\";\r\nimport PersonIcon from \"@material-ui/icons/Person\";\r\nimport Chatbody from \"./Chatbody\";\r\nimport \"./Chat.css\";\r\n\r\n// import Pusher from \"pusher-js\";\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport axios from \"./axios\";\r\nimport jwt_decode from \"jwt-decode\";\r\n\r\nconst token = localStorage.getItem(\"token\");\r\nconst decoded = jwt_decode(token);\r\n\r\nconst existingUser = decoded.existUser.name;\r\n\r\nconst drawerWidth = 200;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: \"flex\",\r\n  },\r\n  appBar: {\r\n    transition: theme.transitions.create([\"margin\", \"width\"], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n  appBarShift: {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: drawerWidth,\r\n    transition: theme.transitions.create([\"margin\", \"width\"], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  menuButton: {\r\n    marginRight: theme.spacing(2),\r\n  },\r\n  hide: {\r\n    display: \"none\",\r\n  },\r\n  drawer: {\r\n    width: drawerWidth,\r\n    flexShrink: 0,\r\n  },\r\n  drawerPaper: {\r\n    width: drawerWidth,\r\n  },\r\n  drawerHeader: {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    padding: theme.spacing(0, 1),\r\n    // necessary for content to be below app bar\r\n    ...theme.mixins.toolbar,\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    transition: theme.transitions.create(\"margin\", {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    marginLeft: -drawerWidth,\r\n  },\r\n  contentShift: {\r\n    transition: theme.transitions.create(\"margin\", {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n    marginLeft: 0,\r\n  },\r\n}));\r\n\r\nexport default function Chat() {\r\n  //messages\r\n  const [username, setUsername] = useState(\"\");\r\n  const [recievername, setrecievername] = useState(\"\");\r\n  useEffect(() => {\r\n    setUsername(existingUser);\r\n    setrecievername(prompt(\"Please enter to name\"));\r\n  }, []);\r\n  var pusher = new Pusher(\"7b837337ccb8aebc6007\", {\r\n    cluster: \"ap2\",\r\n  });\r\n\r\n  const [messages, setMessages] = useState([]);\r\n  const [userList, setuserList] = useState([]);\r\n  const messagesEndRef = useRef(null);\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n  const sync = async () => {\r\n    await axios.get(\"/messages/sync\").then((res) => {\r\n      setMessages(res.data);\r\n    });\r\n  };\r\n  const userlist = async () => {\r\n    await axios.get(\"/users/userlist\").then((res) => {\r\n      setuserList(res.data);\r\n    });\r\n  };\r\n  // useEffect(() => {\r\n  //   userlist();\r\n  //   sync();\r\n  //   scrollToBottom();\r\n  // });\r\n  // ()=>{\r\n  // sync();\r\n  // userlist();\r\n\r\n  // }\r\n  // pusher\r\n  useEffect(() => {\r\n    const channel = pusher.subscribe(\"mern-msg\");\r\n    channel.bind(\"inserted\", function (newMessage) {\r\n      sync();\r\n      userlist();\r\n    });\r\n\r\n    return () => {\r\n      channel.unbind_all();\r\n    };\r\n  }, [messages]);\r\n\r\n  //drawers\r\n  const classes = useStyles();\r\n  const theme = useTheme();\r\n  const [open, setOpen] = React.useState(true);\r\n\r\n  const handleDrawerOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  const handleDrawerClose = () => {\r\n    setOpen(false);\r\n  };\r\n  console.log(userlist);\r\n  return (\r\n    <div className={classes.root}>\r\n      <CssBaseline />\r\n\r\n      <AppBar\r\n        position=\"fixed\"\r\n        className={clsx(classes.appBar, {\r\n          [classes.appBarShift]: open,\r\n        })}\r\n      >\r\n        <Toolbar>\r\n          <IconButton\r\n            color=\"inherit\"\r\n            aria-label=\"open drawer\"\r\n            onClick={handleDrawerOpen}\r\n            edge=\"start\"\r\n            className={clsx(classes.menuButton, open && classes.hide)}\r\n          >\r\n            <MenuIcon />\r\n          </IconButton>\r\n          <Typography variant=\"h6\" noWrap>\r\n            Persistent drawer\r\n          </Typography>\r\n        </Toolbar>\r\n      </AppBar>\r\n      <Drawer\r\n        className={classes.drawer}\r\n        variant=\"persistent\"\r\n        anchor=\"left\"\r\n        open={open}\r\n        classes={{\r\n          paper: classes.drawerPaper,\r\n        }}\r\n      >\r\n        <div className={classes.drawerHeader}>\r\n          <Avatar />\r\n          <h2>Sender name</h2>\r\n          <IconButton onClick={handleDrawerClose}>\r\n            {theme.direction === \"ltr\" ? (\r\n              <ChevronLeftIcon />\r\n            ) : (\r\n              <ChevronRightIcon />\r\n            )}\r\n          </IconButton>\r\n        </div>\r\n\r\n        <Divider />\r\n\r\n        <List>\r\n          {userList.map((users) => (\r\n            <ListItem button key={users._id}>\r\n              <ListItemIcon>\r\n                <Avatar className={classes.small}></Avatar>\r\n              </ListItemIcon>\r\n              <ListItemText primary={users.name} />\r\n            </ListItem>\r\n          ))}\r\n        </List>\r\n      </Drawer>\r\n\r\n      <main>\r\n        <div className=\"chat fixed-bottom\">\r\n          <Chatbody messages={messages} name={username} toName={recievername} />\r\n          {scrollToBottom()}\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}